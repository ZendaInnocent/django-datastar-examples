{% extends "examples_base.html" %}

{% block content %}

{% block howto_content %}
<div class="container-fluid px-0">
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0">How to Build: Inline Validation</h5>
    </div>
    <div class="card-body">
  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 1: The View</h6>
<pre class="bg-light p-3 rounded small mb-4"><code class="language-python"># views.py
from django.core.validators import validate_email, ValidationError

def inline_validation_view(request):
    return render(request, 'inline_validation.html')

def inline_validation_validate_view(request):
    ds = DjangoDatastar(request)
    field = request.GET.get('field')
    value = request.GET.get('value', '')

    errors = {}
    if field == 'email':
        try:
            validate_email(value)
        except ValidationError:
            errors['email'] = 'Please enter a valid email address'
    # ... validate other fields

    return ds.fragment(render_to_string('fragments/validation_error.html', {
        'field': field,
        'errors': errors
    }))</code></pre>

  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 2: The URL</h6>
<pre class="bg-light p-3 rounded small mb-4"><code class="language-python"># urls.py
path('inline-validation/', views.inline_validation_view, name='inline-validation'),
path('inline-validation/validate/', views.inline_validation_validate_view, name='inline-validation-validate'),</code></pre>

  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 3: The Template</h6>
  <p class="small text-muted mb-3">Use <code>data-on:blur</code> to validate when focus leaves:</p>
<pre class="bg-light p-3 rounded small mb-4"><code class="language-django">&lt;input
  type="email"
  name="email"
  data-on:blur="@get('{% url 'examples:inline-validation-validate' %}?field=email&value=' + $event.target.value)"
&gt;
&lt;div id="email-error"&gt;&lt;/div&gt;

&lt;input
  type="text"
  name="username"
  data-on:blur="@get('{% url 'examples:inline-validation-validate' %}?field=username&value=' + $event.target.value)"
&gt;
&lt;div id="username-error"&gt;&lt;/div&gt;</code></pre>

  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 4: The Error Fragment</h6>
<pre class="bg-light p-3 rounded small"><code class="language-django">&lt;div id="{{ field }}-error" class="text-danger small"&gt;
  {% for error in errors.values %}
  {{ error }}
  {% endfor %}
&lt;/div&gt;</code></pre>
    </div>
  </div>
</div>
{% endblock howto_content %}

<div class="container py-5">
  <header class="mb-5">
    <h1 class="h2">Inline Validation</h1>
    <p class="text-muted">Validate form fields in real-time without page reload</p>
  </header>

  <section class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="h5 mb-3">How it Works</h2>
      <ol class="text-muted small">
        <li>User types in a field</li>
        <li>On blur (focus leaves field), Datastar sends GET with field name and value</li>
        <li>Server validates and returns error message fragment if invalid</li>
        <li>Datastar merges error fragment below the field</li>
      </ol>
    </div>
  </section>

  <div class="card shadow-sm">
    <div class="card-body">
      <form>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input
            type="email"
            name="email"
            class="form-control"
            placeholder="Enter email"
            data-on:blur="@get('{% url 'examples:inline-validation-validate' %}?field=email&value=' + $event.target.value)"
          />
          <div id="email-error"></div>
        </div>

        <div class="mb-3">
          <label class="form-label">Username</label>
          <input
            type="text"
            name="username"
            class="form-control"
            placeholder="Enter username (min 3 chars)"
            data-on:blur="@get('{% url 'examples:inline-validation-validate' %}?field=username&value=' + $event.target.value)"
          />
          <div id="username-error"></div>
        </div>

        <div class="mb-3">
          <label class="form-label">Password</label>
          <input
            type="password"
            name="password"
            class="form-control"
            placeholder="Enter password (min 6 chars)"
            data-on:blur="@get('{% url 'examples:inline-validation-validate' %}?field=password&value=' + $event.target.value)"
          />
          <div id="password-error"></div>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </div>

  <section class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="h5 mb-3">Learn More</h2>
      <ul class="mb-0">
        <li><a href="/docs/datastar-guide/django-forms-integration.md#form-error-display" style="color: #6B46C1; text-decoration: none;">Form Error Display</a></li>
        <li><a href="/docs/datastar-guide/best-practices.md#7-debounce-input-events" style="color: #6B46C1; text-decoration: none;">Debouncing Input Events</a></li>
        <li><a href="/docs/datastar-guide/best-practices.md#3-handle-errors-gracefully" style="color: #6B46C1; text-decoration: none;">Error Handling</a></li>
      </ul>
    </div>
  </section>
</div>
{% endblock content %}
