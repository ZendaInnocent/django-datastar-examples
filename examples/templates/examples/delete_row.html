{% extends "base.html" %}

{% block content %}
{% include 'examples/fragments/example_sidebar.html' %}
{% include 'examples/fragments/howto_panel.html' with title="How to Build: Delete Row" %}

<button
  class="btn btn-outline-secondary position-fixed top-50 start-0 translate-middle-y ms-3 rounded-pill shadow-sm d-none d-md-flex align-items-center gap-2"
  type="button"
  data-bs-toggle="offcanvas"
  data-bs-target="#exampleSidebar"
  aria-controls="exampleSidebar"
  style="z-index: 1050;"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
  </svg>
  <span>Examples</span>
</button>

<button
  class="btn btn-outline-secondary position-fixed top-50 start-0 translate-middle-y ms-3 rounded-pill shadow-sm d-md-none"
  type="button"
  data-bs-toggle="offcanvas"
  data-bs-target="#exampleSidebar"
  aria-controls="exampleSidebar"
  style="z-index: 1050;"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
  </svg>
</button>

{% block howto_content %}
<div class="container-fluid px-0">
  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 1: The View</h6>
  <pre class="bg-light p-3 rounded small mb-4"><code># views.py
def delete_row_view(request):
    contacts = Contact.objects.all()[:5]
    return render(request, 'delete_row.html', {'contacts': contacts})

def delete_row_remove_view(request):
    ds = DjangoDatastar(request)
    contact_id = request.POST.get('id')
    contact = get_object_or_404(Contact, pk=contact_id)
    contact.delete()
    return ds.remove(selector=f'#contact-{contact_id}')</code></pre>

  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 2: The URL</h6>
  <pre class="bg-light p-3 rounded small mb-4"><code># urls.py
path('delete-row/', views.delete_row_view, name='delete-row'),
path('delete-row/remove/', views.delete_row_remove_view, name='delete-row-remove'),</code></pre>

  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 3: The Template</h6>
  <p class="small text-muted mb-3">Use <code>data-on:click</code> with confirmation:</p>
  <pre class="bg-light p-3 rounded small mb-4"><code>&lt;tr id="contact-{{ contact.pk }}"&gt;
  &lt;td&gt;{{ contact.first_name }} {{ contact.last_name }}&lt;/td&gt;
  &lt;td&gt;
    &lt;button
      data-on:click="if(confirm('Delete?')) @post('{% url 'examples:delete-row-remove' %}', {params: {id: {{ contact.pk }}}})"
    &gt;
      Delete
    &lt;/button&gt;
  &lt;/td&gt;
&lt;/tr&gt;</code></pre>

  <h6 class="text-uppercase text-muted small fw-bold mb-3">Step 4: The Server Response</h6>
  <p class="small text-muted mb-3">Return a remove directive instead of HTML:</p>
  <pre class="bg-light p-3 rounded small"><code># In the view, use ds.remove() to remove element
return ds.remove(selector='#contact-{{ contact_id }}')</code></pre>
</div>
{% endblock howto_content %}

<div class="container py-5">
  <header class="mb-5">
    <h1 class="h2">Delete Row</h1>
    <p class="text-muted">Delete table rows with confirmation and animation</p>
  </header>

  <section class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="h5 mb-3">How it Works</h2>
      <ol class="text-muted small">
        <li>Click "Delete" button to show confirmation</li>
        <li>Confirm delete sends POST request to <code>/delete-row/remove/</code></li>
        <li>Server returns a remove directive</li>
        <li>Datastar removes the element from the DOM with animation</li>
      </ol>
    </div>
  </section>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="contact-table">
        {% for contact in contacts %}
        <tr id="contact-{{ contact.id }}">
          <td>{{ contact.first_name }} {{ contact.last_name }}</td>
          <td>{{ contact.email }}</td>
          <td>
            <button
              class="btn btn-outline-danger btn-sm"
              data-on:click="if(confirm('Delete this contact?')) @post('{% url 'examples:delete-row-remove' %}', {params: {id: {{ contact.id }}}})"
            >
              Delete
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock content %}
