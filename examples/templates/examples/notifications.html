{% extends "base.html" %}

{% block content %}

  <div class="container py-3">

    <header class="mb-5">
      <h1 class="h2">Notifications</h1>
      <p class="text-muted">Real-time notification counter with SSE push updates</p>
    </header>

    <section class="card shadow-sm mb-4">
      <div class="card-body">
        <h2 class="h5 mb-3">How it Works</h2>
        <ol class="text-muted small">
          <li>Notification count is stored in a signal</li>
          <li>Page establishes SSE connection to receive updates</li>
          <li>Server can push new counts via Server-Sent Events</li>
          <li>Datastar automatically updates the UI when signal changes</li>
        </ol>
      </div>
    </section>

    <div class="row"
         data-signals="{notificationCount: 0, notificationId: ''}"
         data-init="@get('{% url "examples:notifications-count" %}')">
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="mb-0">Notifications</h5>
              <span class="badge bg-success"
                    id="notification-count"
                    data-text="`${$notificationCount} Unread`"></span>
            </div>
            <button class="btn btn-outline-primary btn-sm"
                    data-show="$notificationCount > 0"
                    data-on:click="$notificationId = ''; @post('{% url 'examples:notifications-mark-read' %}')">
              Mark all as read
            </button>
            <button class="btn btn-outline-success btn-sm"
                    data-show="$notificationCount > 0"
                    data-indicator:_fetching
                    data-attr:disabled="$_fetching"
                    data-on:click="@get('{% url 'examples:notifications-sse' %}')">
              Read
              <div class="spinner-border spinner-border-sm"
                   role="status"
                   data-show="$_fetching">
                <span class="visually-hidden">Loading...</span>
              </div>
            </button>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div id="notifications-list"></div>
      </div>
    </div>

    <section class="card shadow-sm my-4">
      <div class="card-body">
        <h2 class="h5 mb-3">Learn More</h2>
        <ul class="mb-0">
          <li>
            <a href="https://data-star.dev/guide/backend_requests#sse-events"
               target="_blank"
               class="text-decoration-none">Real-time Updates</a>
          </li>
          <li>
            <a href="https://data-star.dev/guide/backend_requests#sse-events"
               target="_blank"
               class="text-decoration-none">Server-Sent Events (SSE)</a>
          </li>
          <li>
            <a href="https://data-star.dev/guide/backend_requests#backend-actions"
               target="_blank"
               class="text-decoration-none">Datastar Actions</a>
          </li>
        </ul>
      </div>
    </section>
  </div>
{% endblock content %}
